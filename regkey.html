<!DOCTYPE html>
<html lang="en-GB">

	<head>
		<title>Hyperphase Key Registrar</title>
	</head>
	<button id="button">Register New Key</button>
	<script type="text/javascript" src="resources/scripts/u2f-api.js"></script>
	<script type="text/javascript">
		function httpGetAsync(theUrl, callback) {
			var xmlHttp = new XMLHttpRequest();
			xmlHttp.onreadystatechange = function () {
				if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
					callback(xmlHttp.responseText);
			}
			xmlHttp.open("GET", theUrl, true); // true for asynchronous
			xmlHttp.send(null);
		}
		window.onload = function () {
			document.getElementById('button').onclick = function () {
				httpGetAsync('https://hyperphase.app/newkey', function (registrationRequest) {
					var registrationRequest = JSON.parse(registrationRequest);
					console.log(registrationRequest);
					/*u2fApi.register(JSON.parse(registrationRequest)).then(function (data) {
						console.log(data);
					}).catch(function (error) {
						console.log(error);
					});*/
					/*u2f.register(registrationRequest.appId, [registrationRequest], function (data) {
						console.log(data);
					});*/
					let credential = navigator.credentials.create({
						publicKey: {
							challenge: registrationRequest.challenge,
							rp: { id: "hyperphase.app", name: "Hyperphase" },
							user: {
								id: new Uint8Array([79, 252, 83, 72, 214, 7, 89, 26]),
								name: "thetimekeeper@hyperphase.app",
								displayName: "The Timekeeper"
							},
							pubKeyCredParams: [{ type: "public-key", alg: -7 }]
						}
					});
				});
			}
		}
	</script>

</html>